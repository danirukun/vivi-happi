---
import { type CollectionEntry, getCollection, render } from 'astro:content';
import Layout from '../../../layouts/Layout.astro';
import Header from '../../../components/Header.astro';
import Footer from '../../../components/Footer.astro';
import Hero from '../../../components/Hero.astro';

export async function getStaticPaths() {
	const posts = await getCollection('updates', ({ data }: CollectionEntry<'updates'>) => data.language === 'ja');
	return posts.map((post: CollectionEntry<'updates'>) => ({
		params: { slug: post.slug.split('/').pop() },
		props: post,
	}));
}
type Props = CollectionEntry<'updates'>;

const post = Astro.props;
const { Content } = await render(post);
---

<Layout title={`${post.data.title} - ヴィヴィ法被プロジェクト`} description={post.data.description}>
	<Header background="bg-vivi-purple-900/95" />
	
	<main>
		<Hero variant="primary" padding="py-16 md:py-24">
			<article class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 bg-vivi-pink-50 rounded-3xl p-8 md:p-12 border-2 border-vivi-purple-200">
				<div class="mb-8 text-center">
					<time datetime={post.data.pubDate.toISOString()} class="text-vivi-purple-600 font-bold tracking-wider uppercase text-sm">
						{post.data.pubDate.toLocaleDateString('ja-JP', {
							year: 'numeric',
							month: 'long',
							day: 'numeric',
						})}
					</time>
					<h1 class="text-3xl md:text-5xl font-bold text-vivi-purple-900 mt-4 mb-6 leading-tight font-yuruka">
						{post.data.title}
					</h1>
					<div class="h-1 w-20 bg-vivi-pink-400 mx-auto rounded-full"></div>
				</div>

				<div class="prose prose-lg prose-vivi max-w-none prose-headings:text-vivi-purple-900 prose-headings:font-yuruka prose-p:text-vivi-purple-800 prose-a:text-vivi-pink-600 hover:prose-a:text-vivi-pink-700 prose-strong:text-vivi-purple-900 prose-li:text-vivi-purple-800">
					<Content />
				</div>
				
				<div class="mt-16 pt-8 border-t border-vivi-purple-100 flex justify-center">
					<a href="/ja/updates/" class="text-vivi-purple-600 hover:text-vivi-purple-800 font-bold flex items-center transition-colors">
						<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
							<path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
						</svg>
						アップデート一覧に戻る
					</a>
				</div>
			</article>
		</Hero>
	</main>

	<Footer />
</Layout>

<style is:global>
	.prose-vivi h2 {
		@apply text-2xl md:text-3xl mt-12 mb-6 border-b-2 border-vivi-pink-200 pb-2;
	}
	.prose-vivi h3 {
		@apply text-xl md:text-2xl mt-8 mb-4;
	}
	.prose-vivi p {
		@apply mb-6;
	}
	.prose-vivi ul {
		@apply list-disc list-outside ml-6 mb-6;
	}
	.prose-vivi li {
		@apply mb-2;
	}
</style>
