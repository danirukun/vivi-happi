---
import '../styles/global.css';
import { getImage } from 'astro:assets';
import type { ImageMetadata } from 'astro';

interface Props {
	title?: string;
	description?: string;
	ogImage?: ImageMetadata;
}

const { 
	title = 'Kikirara Vivi (綺々羅々ヴィヴィ) Happi - Hololive 7th Fes & Super Expo 2026 | Ridin on Dreams',
	description = 'Preorder your Kikirara Vivi (綺々羅々ヴィヴィ) Happi coat for hololive 7th fes and Super Expo 2026 - Ridin on Dreams. Made to order, worldwide shipping.',
	ogImage
} = Astro.props;

const keywords = 'hololive 7th fes, super expo 2026, ridin on dreams, kikirara vivi, 綺々羅々ヴィヴィ, vivi happi, hololive merch, happi coat, holofes 7';

let ogImageUrl: string | null = null;
if (ogImage) {
	const optimizedImage = await getImage({ src: ogImage, width: 1200, height: 630 });
	ogImageUrl = optimizedImage.src.startsWith('http') 
		? optimizedImage.src 
		: new URL(optimizedImage.src, Astro.url.origin).href;
}
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/x-icon" href="/favicon.ico" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<meta name="description" content={description} />
		<meta name="keywords" content={keywords} />
		<title>{title}</title>
		{ogImageUrl && (
			<script type="application/ld+json" set:html={JSON.stringify({
				"@context": "https://schema.org",
				"@type": "Product",
				"name": "Kikirara Vivi Happi Coat",
				"alternateName": "綺々羅々ヴィヴィ ハッピ",
				"description": description,
				"image": [ogImageUrl],
				"brand": {
					"@type": "Brand",
					"name": "Kikirara Vivi"
				},
				"offers": {
					"@type": "Offer",
					"availability": "https://schema.org/PreOrder",
					"priceCurrency": "USD",
					"availabilityStarts": "2026-01-01"
				},
				"event": {
					"@type": "Event",
					"name": "hololive 7th fes - Ridin on Dreams",
					"alternateName": "Super Expo 2026",
					"startDate": "2026-03-01"
				}
			})} />
		)}
		{ogImageUrl && (
			<>
				<meta property="og:type" content="website" />
				<meta property="og:title" content={title} />
				<meta property="og:description" content={description} />
				<meta property="og:image" content={ogImageUrl} />
				<meta property="og:image:width" content="1200" />
				<meta property="og:image:height" content="630" />
				<meta name="twitter:card" content="summary_large_image" />
				<meta name="twitter:title" content={title} />
				<meta name="twitter:description" content={description} />
				<meta name="twitter:image" content={ogImageUrl} />
			</>
		)}
	</head>
	<body class="bg-vivi-pink-300 text-gray-900 font-sans">
		<slot />
		<script is:inline src="https://cdn.jsdelivr.net/npm/flowbite@2.3.0/dist/flowbite.min.js"></script>
	</body>
</html>

